<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE NgamsCfg SYSTEM "ngamsCfg.dtd">

<NgamsCfg Id="ngamsCfgMwa-VM">

  <Header Context="NGAMS"
          Name="ngamsServer.xml"
          Release="2.0"
          Revision="2.0 2013/01/04 12:00:00 awicenec"
          Source="ngast@icrar.org"
          Type="NGAMS-CONFIGURATION">
    <Description>
      Configuration used for the VM NGAS servers, which do make use of
      RAID volumes rather than single disks. There is no replication
      configured.
      *NOTES*: The DB configuration has to be adjusted to the actual
                 situation.
               The volume has to be mounted on RootDirectory/volume1 at
                 boot time. NGAS does not do the mounting with this
                 configuration.
               There is no mirroring or caching configured yet.

               This version allows to specify an IpAddress attribute
               in the Server element. This IP address will be used
               to bind the server to instead of the automatic host
               name determination.
    </Description>
  </Header>

  <Server Id="Server-MWA"
          ArchiveName="MWA-ARCHIVE-VM"
          BlockSize="65536"
          MaxSimReqs="10"
          RootDirectory="*replaceRoot*"
          PortNo="7777"
          ProxyMode="1"
          Simulation="0"
          SwVersion=""/>

  <JanitorThread Id="JanitorThread-Std"
                 SuspensionTime="0T00:10:00"
                 MinSpaceSysDirMb="500"/>

  <ArchiveHandling Id="ArchiveHandling"
                   ArchiveUnits="ngas03"
                   BackLogBufferDirectory="."
                   BackLogBuffering="0"
                   FreeSpaceDiskChangeMb="20"
                   MinFreeSpaceWarningMb="500"
                   PathPrefix="MWAArchive"
                   Replication="0"/>

  <Db     Id="Db-Sqlite-Test"
    Server="localhost"
    Interface="ngamsSqlite"
          Name="ngas.sqlite"
          User="ngas"
          Password="bmdhcyRkYmE=\n"
          Snapshot="1"/>


  <SystemPlugIns Id="SystemPlugIns-Std"
                 LabelPrinterPlugIn="-"
                 LabelPrinterPlugInPars="-"
                 OfflinePlugIn="ngamsGenericOfflinePlugIn"
                 OfflinePlugInPars="unmount=0"
                 OnlinePlugIn="ngamsGenericOnlinePlugIn"
                 OnlinePlugInPars=""
                 DiskSyncPlugIn=""
                 DiskSyncPlugInPars=""/>

  <Permissions Id="Permissions"
               AllowArchiveReq="1"
               AllowProcessingReq="1"
               AllowRemoveReq="1"
               AllowRetrieveReq="1"/>

  <MimeTypes Id="MimeTypes-Std">
    <MimeTypeMap Extension="fits" MimeType="image/x-fits"/>
    <MimeTypeMap Extension="nglog" MimeType="ngas/nglog"/>
    <MimeTypeMap Extension="nglog.gz" MimeType="application/x-nglog"/>
    <MimeTypeMap Extension="log" MimeType="text/log-file"/>
    <MimeTypeMap Extension="log.Z" MimeType="application/x-clog"/>
    <MimeTypeMap Extension="paf" MimeType="ngas/paf"/>
    <MimeTypeMap Extension="fits.gz" MimeType="application/x-gfits"/>
    <MimeTypeMap Extension="fits.Z" MimeType="application/x-cfits"/>
    <MimeTypeMap Extension="hfits" MimeType="application/x-hfits"/>
    <MimeTypeMap Extension="hdr" MimeType="image/x-fitshdr"/>
    <MimeTypeMap Extension="tar" MimeType="application/x-tar"/>
    <MimeTypeMap Extension="msg" MimeType="multialma/related"/>
    <MimeTypeMap Extension="bin" MimeType="application/octet-stream"/>
  </MimeTypes>

  <StorageSets>
    <StorageSet DiskLabel="BULK"
                MainDiskSlotId="volume1"
                Mutex="0"
                Synchronize="1"
                StorageSetId="volume1"/>
    <StorageSet DiskLabel="BULK"
                MainDiskSlotId="volume2"
                Mutex="0"
                StorageSetId="volume2"
                Synchronize="1"/>
    <StorageSet DiskLabel="BULK"
                MainDiskSlotId="volume3"
                Mutex="0"
                StorageSetId="volume3"
                Synchronize="1"/>
  </StorageSets>

  <Streams>
    <Stream MimeType="application/octet-stream"
            PlugIn="ngamsGenDapi"
            PlugInPars="">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="image/x-fits"
            PlugIn="ngamsFitsPlugIn"
            PlugInPars="compression=compress -f,
                        checksum_util=utilFitsChecksum,
                        checksum_result=0/0000000000000000,
                        frame_ingest_db_id=TEST_SRV">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="cal/x-fits" PlugIn="ngamsCalibDapi" PlugInPars="">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="cal/x-tfits" PlugIn="ngamsCalibDapi" PlugInPars="">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="non/existing" PlugIn="ngamsNonExisting" PlugInPars="">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="application/x-cfits"
            PlugIn="ngamsFitsPlugIn"
            PlugInPars="compression=compress -f,
                        checksum_util=utilFitsChecksum,
                        checksum_result=0/0000000000000000">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="application/x-gfits"
            PlugIn="ngamsFitsPlugIn"
            PlugInPars="compression=compress -f,
                        checksum_util=utilFitsChecksum,
                        checksum_result=0/0000000000000000">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="ngas/nglog"
            PlugIn="ngamsNgLogPlugIn"
            PlugInPars="">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="text/log-file"
            PlugIn="ngamsNgLogPlugIn"
            PlugInPars="">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="application/x-tar"
            PlugIn="ngasTarBallPlugIn"
            PlugInPars="">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
    <Stream MimeType="multialma/related"
            PlugIn="ngamsSdmMultipart"
            PlugInPars="">
      <StorageSetRef StorageSetId="volume1"/>
      <StorageSetRef StorageSetId="volume2"/>
      <StorageSetRef StorageSetId="volume3"/>
    </Stream>
  </Streams>

  <Processing Id="Processing-Std"
              ProcessingDirectory=".">
    <PlugIn Name="ngamsEsoArchDppi"
            PlugInPars="">
      <MimeType Name="image/x-fits"/>
      <MimeType Name="application/x-gfits"/>
      <MimeType Name="application/x-cfits"/>
    </PlugIn>
    <PlugIn Name="ngamsExtractFitsHdrDppi"
            PlugInPars="">
      <MimeType Name="image/x-fits"/>
      <MimeType Name="application/x-gfits"/>
      <MimeType Name="application/x-cfits"/>
    </PlugIn>
    <PlugIn Name="ngasWfiPreview"
            PlugInPars="">
      <MimeType Name="image/x-fits"/>
      <MimeType Name="application/x-gfits"/>
      <MimeType Name="application/x-cfits"/>
    </PlugIn>
  </Processing>

  <Register Id="Register-Std">
    <PlugIn Name="ngamsFitsRegPlugIn"
            PlugInPars="checksum_util=utilFitsChecksum,
                        checksum_result=0/0000000000000000">
      <MimeType Name="image/x-fits"/>
      <MimeType Name="application/x-gfits"/>
      <MimeType Name="application/x-cfits"/>
    </PlugIn>
  </Register>

  <DataCheckThread Id="DataCheckThread"
                   Active="1"
                   ChecksumPlugIn="ngamsGenCrc32"
                   ChecksumPlugInPars=""
   DiskSeq="SEQUENTIAL"
                   FileSeq="SEQUENTIAL"
                   ForceNotif="1"
                   LogSummary="1"
                   MaxProcs="4"
                   MinCycle="01T00:00:00"
                   Prio="0"
                   Scan="0"/>

  <Log Id="Log"
       LocalLogFile="log/LogFile.nglog"
       LocalLogLevel="3"
       LogBufferSize="0"
       LogRotateCache="30"
       LogRotateInt="01T00:00:00"
       SysLog="0"
       SysLogPrefix="DFSLog"/>

  <Notification Id="Notification"
                Active="1"
                MaxRetentionSize="1"
                MaxRetentionTime="00T00:30:00"
                Sender="ngast@hq.eso.org"
                SmtpHost="smtphost.hq.eso.org">
    <AlertNotification>
      <EmailRecipient Address="DEFINE@eso.org"/>
    </AlertNotification>
    <ErrorNotification>
      <EmailRecipient Address="DEFINE@eso.org"/>
    </ErrorNotification>
    <DiskSpaceNotification>
      <EmailRecipient Address="DEFINE@eso.org"/>
    </DiskSpaceNotification>
    <DiskChangeNotification>
      <EmailRecipient Address="DEFINE@eso.org"/>
    </DiskChangeNotification>
    <NoDiskSpaceNotification>
      <EmailRecipient Address="DEFINE@eso.org"/>
    </NoDiskSpaceNotification>
    <DataCheckNotification>
      <EmailRecipient Address="DEFINE@eso.org"/>
    </DataCheckNotification>
  </Notification>

  <HostSuspension Id="HostSuspension"
                  IdleSuspension="0"
                  IdleSuspensionTime="60"
                  SuspensionPlugIn="ngamsSuspensionPlugIn"
                  SuspensionPlugInPars="--SuspensionPlugInPars--"
                  WakeUpCallTimeOut="200"
                  WakeUpPlugIn="ngamsWakeUpPlugIn"
                  WakeUpPlugInPars="eth0,eth1"
                  WakeUpServerHost="arch01"/>

  <SubscriptionDef Id="SubscriptionDef"
                   AutoUnsubscribe="1"
                   BackLogExpTime="28T00:00:00"
                   Enable="0"
                   SuspensionTime="0T00:03:00">
    <Subscription  HostId="HostId1"
                   PortNo="1234"
                   Priority="1"
                   SubscriberUrl="http://test.url1"
                   FilterPlugIn="FilterPlugIn1"
                   FilterPlugInPars="1,2,3,4"/>
    <Subscription  HostId="HostId2"
                   PortNo="5678"
                   Priority="2"
                   SubscriberUrl="http://test.url2"
                   FilterPlugIn="FilterPlugIn2"
                   FilterPlugInPars="5,6,7,8"/>
  </SubscriptionDef>


  <Authorization Id="Authorization"
                 Enable="0">
    <User Name="ngas"
          Password="bmdhcw=="/>
    <User Name="ngasmgr"
          Password="bmdhc21ncg=="/>
    <User Name="ngas-int"
          Password="bmdhcy1pbnQ="/>
  </Authorization>

  <DataMoverOnly FromHostIds="127.0.0.1:7778, 127.0.0.1:7779"
  				 SuspensionTime="0T00:00:30"/>

</NgamsCfg>
